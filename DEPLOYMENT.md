# üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Compliment Bot

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ–≥–æ 3 —à–∞–≥–∞:

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
nano .env  # –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up -d

# 3. –ì–æ—Ç–æ–≤–æ! üéâ
```

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ `docker-compose up -d` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è:

‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Composer  
‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ PostgreSQL  
‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π  
‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Messenger —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–≤  
‚úÖ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö supervisor –ø—Ä–æ—Ü–µ—Å—Å–æ–≤  

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
# Telegram Bot API
TELEGRAM_BOT_TOKEN=your_bot_token_from_@BotFather

# DeepSeek API
DEEPSEEK_API_KEY=your_deepseek_api_key

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–º–æ–∂–Ω–æ –Ω–µ –º–µ–Ω—è—Ç—å)
DATABASE_URL="postgresql://app:!ChangeMe!@db:5432/app?serverVersion=15&charset=utf8"
MESSENGER_TRANSPORT_DSN=doctrine://default?auto_setup=0

# –ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∫–∏
ADMIN_PASSWORD=admin123

# –û–∫—Ä—É–∂–µ–Ω–∏–µ
APP_ENV=dev
```

## –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

- URL: **http://localhost:8848/admin**
- –ü–∞—Ä–æ–ª—å: –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `ADMIN_PASSWORD` –≤ .env
- –§—É–Ω–∫—Ü–∏–∏:
  - ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞
  - üìä –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  - ‚úÖ/‚ùå –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–æ–∫
  - üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:

- **–ë—É–¥–Ω–∏ (–ü–Ω-–ü—Ç)**: –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏
- **–í—ã—Ö–æ–¥–Ω—ã–µ (–°–±-–í—Å)**: –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ

–í—Å–µ –≤—Ä–µ–º–µ–Ω–∞ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É **Europe/Moscow** (–ú–°–ö).

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –õ–æ–≥–∏ –±–æ—Ç–∞
docker-compose logs -f supervisor

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
docker-compose exec supervisor tail -f /var/log/supervisor/telegram-bot.out.log
docker-compose exec supervisor tail -f /var/log/supervisor/scheduler-trigger.out.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose exec db psql -U app -d app -c "SELECT * FROM subscriptions;"
```

## –£–¥–∞–ª–µ–Ω–∏–µ Telegram Webhook (–µ—Å–ª–∏ –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

–ï—Å–ª–∏ –±–æ—Ç —Ä–∞–Ω–µ–µ —Ä–∞–±–æ—Ç–∞–ª —Å webhook, –Ω—É–∂–Ω–æ –µ–≥–æ —É–¥–∞–ª–∏—Ç—å:

```bash
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/deleteWebhook?drop_pending_updates=true"
```

## –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è)
docker-compose stop

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è)
docker-compose down

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ (–≤–∫–ª—é—á–∞—è –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö)
docker-compose down -v
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å/—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
git clone <your-repo> compliment-bot
cd compliment-bot

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env
cp .env.example .env
nano .env

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d

# –ì–æ—Ç–æ–≤–æ! –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

- **db** - PostgreSQL 15 (–ø–æ—Ä—Ç 5432)
- **app** - PHP 8.2-FPM —Å Symfony
- **nginx** - Nginx –≤–µ–±-—Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 8848)
- **supervisor** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ–Ω–æ–≤—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

### Supervisor –ø—Ä–æ—Ü–µ—Å—Å—ã

- **telegram-bot** - Long polling –±–æ—Ç–∞
- **messenger-consumer** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ async
- **scheduler-worker** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ scheduler_compliments
- **scheduler-trigger** - –¢—Ä–∏–≥–≥–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏ (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)

### –¢–∞–±–ª–∏—Ü—ã –ë–î

- **subscriptions** - –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤—Ä–µ–º–µ–Ω–∏
- **messenger_messages** - –û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π
- **doctrine_migration_versions** - –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

## Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook —É–¥–∞–ª–µ–Ω:
   ```bash
   curl "https://api.telegram.org/bot<TOKEN>/getWebhookInfo"
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   ```bash
   docker-compose logs supervisor | grep -i error
   ```

### –ö–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ scheduler-trigger —Ä–∞–±–æ—Ç–∞–µ—Ç:
   ```bash
   docker-compose exec supervisor ps aux | grep trigger
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—á–µ—Ä–µ–¥—å:
   ```bash
   docker-compose exec app php bin/console messenger:stats
   ```
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤ –∞–¥–º–∏–Ω–∫–µ

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç 5432 —Å–≤–æ–±–æ–¥–µ–Ω:
   ```bash
   lsof -i :5432
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PostgreSQL:
   ```bash
   docker-compose logs db
   ```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **PHP**: 8.2-FPM-Alpine
- **Symfony**: 6.4
- **PostgreSQL**: 15-Alpine
- **Nginx**: Alpine
- **AI**: DeepSeek API (OpenAI-compatible)
- **–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å**: Europe/Moscow

## –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker 20.10+
- Docker Compose 2.0+
- 512 MB RAM
- 1 GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞

---

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π! üöÄ**
